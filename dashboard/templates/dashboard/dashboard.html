{% extends "dashboard/base.html" %}
{% load static %}

{% block content %}
<div class="bg-white shadow-lg rounded-2xl mx-auto mt-10 px-10 py-14 max-w-7xl">
  <!-- ðŸ§© TITLE -->
  <div class="text-center mb-10">
    <h1 class="text-5xl font-extrabold text-emerald-600">CityMind Analytics Dashboard</h1>
    <p class="text-lg text-gray-600 mt-3">
      Data-driven insights on <b>mental health</b> and <b>depression</b> across U.S. counties.
    </p>
  </div>

  {% if no_data %}
  <!-- âš ï¸ No data -->
  <div class="text-center text-gray-500 italic py-10">
    No analysis data available. Please run <code>snakemake data_insights</code> first.
  </div>
  {% else %}

  <!-- ðŸ§­ SUMMARY STATS -->
  <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 mb-10 text-center">
    <div class="bg-gray-50 border border-gray-200 rounded-xl p-6 shadow-sm">
      <h3 class="text-sm text-gray-500 uppercase mb-1">Total Counties</h3>
      <p class="text-4xl font-extrabold text-emerald-600">
        {{ insights.summary.n_counties|default:"â€”" }}
      </p>
    </div>
    <div class="bg-gray-50 border border-gray-200 rounded-xl p-6 shadow-sm">
      <h3 class="text-sm text-gray-500 uppercase mb-1">Avg Poor Mental Health</h3>
      <p class="text-3xl font-semibold text-emerald-600">
        {{ insights.summary.avg_mhlth|floatformat:2|default:"â€”" }}%
      </p>
    </div>
    <div class="bg-gray-50 border border-gray-200 rounded-xl p-6 shadow-sm">
      <h3 class="text-sm text-gray-500 uppercase mb-1">Avg Depression</h3>
      <p class="text-3xl font-semibold text-emerald-600">
        {{ insights.summary.avg_depression|floatformat:2|default:"â€”" }}%
      </p>
    </div>
  </div>

  <!-- ðŸ§© CORRELATION -->
  <div class="text-center mb-10">
    <h3 class="text-lg font-semibold text-gray-700 mb-2">
      Mental Health â†” Depression Correlation
    </h3>
    <p class="text-xl font-bold text-emerald-700">
      {{ insights.summary.correlation|floatformat:3|default:"â€”" }}
    </p>
  </div>

  <!-- ðŸ—ºï¸ MAP VISUALS -->
  <section class="my-12">
    <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">Geospatial Analysis</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
      <div class="border border-gray-200 rounded-xl p-4">
        <h4 class="text-center text-gray-600 font-semibold mb-2">
          Poor Mental Health
        </h4>
        <div>{{ insights.map_mhlth|safe }}</div>
      </div>
      <div class="border border-gray-200 rounded-xl p-4">
        <h4 class="text-center text-gray-600 font-semibold mb-2">Depression</h4>
        <div>{{ insights.map_dep|safe }}</div>
      </div>
    </div>
  </section>

  <!-- ðŸ”¥ HEATMAP -->
  <section class="my-12">
    <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">
      Correlation Heatmap
    </h2>
    <div class="border border-gray-200 rounded-xl p-4">
      {{ insights.heatmap|safe }}
    </div>
  </section>

  <!-- ðŸ† TOP & BOTTOM COUNTIES -->
  <section class="my-14">
    <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">
      Top & Bottom Counties
    </h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
      <div>
        <h3 class="text-xl font-semibold text-emerald-700 mb-3 text-center">
          Top 5 â€” Poor Mental Health
        </h3>
        <ul class="list-disc pl-8 text-gray-700">
          {% for c in insights.top_mhlth %}
          <li>
            {{ c.countyname }} ({{ c.stateabbr }}) â€” {{ c.mhlth_crudeprev|floatformat:2 }}%
          </li>
          {% endfor %}
        </ul>

        <h3 class="text-xl font-semibold text-red-600 mt-8 mb-3 text-center">
          Bottom 5 â€” Poor Mental Health
        </h3>
        <ul class="list-disc pl-8 text-gray-700">
          {% for c in insights.bottom_mhlth %}
          <li>
            {{ c.countyname }} ({{ c.stateabbr }}) â€” {{ c.mhlth_crudeprev|floatformat:2 }}%
          </li>
          {% endfor %}
        </ul>
      </div>

      <div>
        <h3 class="text-xl font-semibold text-emerald-700 mb-3 text-center">
          Top 5 â€” Depression
        </h3>
        <ul class="list-disc pl-8 text-gray-700">
          {% for c in insights.top_dep %}
          <li>
            {{ c.countyname }} ({{ c.stateabbr }}) â€” {{ c.depression_crudeprev|floatformat:2 }}%
          </li>
          {% endfor %}
        </ul>

        <h3 class="text-xl font-semibold text-red-600 mt-8 mb-3 text-center">
          Bottom 5 â€” Depression
        </h3>
        <ul class="list-disc pl-8 text-gray-700">
          {% for c in insights.bottom_dep %}
          <li>
            {{ c.countyname }} ({{ c.stateabbr }}) â€” {{ c.depression_crudeprev|floatformat:2 }}%
          </li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </section>
  {% endif %}
</div>
{% endblock %}
